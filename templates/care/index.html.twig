{% extends 'base.html.twig' %}

{% block title %}Planning des gardes
{% endblock %}

{% block body %}
	<div
		class="flex flex-row">
		{# Menu sur la gauche #}
		<div class="w-1/4 bg-white p-2 shadow overflow-y-auto">
			<div>
				<h1 class="text-2xl font-semibold text-gray-900">Planning des gardes</h1>
				{% if selected_nanny %}
					<p class="mt-2 text-sm text-gray-700">Planning de
						{{ selected_nanny.firstname }}
						{{ selected_nanny.lastname }}</p>
				{% else %}
					<p class="mt-2 text-sm text-gray-700">Sélectionnez une nounou pour voir son planning</p>
				{% endif %}
			</div>

			{# Dropdown de sélection de nounou #}
			<div class="mt-4">
				<select onchange="if(this.value) window.location.href=this.value" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
					<option value="{{ path('app_care_index') }}" {% if not selected_nanny %} selected {% endif %}>
						Choisir une nounou
					</option>
					{% for nanny in nannies %}
						<option value="{{ path('app_care_index', {'slug': nanny.slug}) }}" {% if selected_nanny and selected_nanny.id == nanny.id %} selected {% endif %}>
							{{ nanny.firstname }}
							{{ nanny.lastname }}
						</option>
					{% endfor %}
				</select>
			</div>

            {% if templates %}
                {# Liste des templates #}
                <div class="mt-4">
                    <h2 class="text-lg font-semibold text-gray-700 mb-2">Templates disponible</h2>
                    {% if templates is empty %}
                        <p class="text-sm text-gray-500 italic">Aucun template disponible</p>
                    {% else %}
                        <div class="space-y-2">
                            {% for template in templates %}
                                <button
                                    onclick="window.calendarController.getWeekForTemplate('{{ template.slug }}')"
                                    class="w-full text-left px-3 py-2 rounded text-sm hover:bg-blue-100 transition-colors flex items-center border border-gray-200">
                                    <span class="flex-grow">{{ template.name }}</span>
                                    <i class="fa-solid fa-check text-gray-400"></i>
                                </button>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
            {% endif %}
        </div>

		{# Calendrier sur la droite #}
		<div class="flex-1 bg-white px-6 py-1 shadow overflow-y-auto">
			{% if selected_nanny %}
				<div data-controller="calendar" data-calendar-events-value="{{ events|json_encode|e('html_attr') }}" data-calendar-nanny-id-value="{{ selected_nanny.id }}">
					<div data-calendar-target="calendar"></div>
				</div>
			{% else %}
				<p class="text-sm text-gray-700">Veuillez sélectionner une nounou pour afficher le calendrier.</p>
			{% endif %}
		</div>
	</div>

{% endblock %}
